<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多平台传感器检测</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 10px;
        }
        
        .platform-info {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .platform-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .sensor-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .sensor-card:hover {
            transform: translateY(-5px);
        }
        
        .sensor-header {
            background: var(--secondary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sensor-status {
            background: white;
            color: var(--secondary);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .sensor-status.active {
            background: var(--success);
            color: white;
        }
        
        .sensor-body {
            padding: 20px;
        }
        
        .sensor-data {
            margin-bottom: 15px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .data-value {
            font-weight: bold;
            color: var(--secondary);
        }
        
        .sensor-visualization {
            height: 100px;
            background: var(--light);
            border-radius: 8px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .visualization-bar {
            position: absolute;
            bottom: 0;
            width: 30px;
            background: var(--secondary);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            background: var(--secondary);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>手机传感器检测系统</h1>
        <p>检测并显示Android、iOS和HarmonyOS设备的所有可用传感器数据</p>
        <div class="platform-info">
            <span class="platform-tag">Android</span>
            <span class="platform-tag">iOS</span>
            <span class="platform-tag">HarmonyOS</span>
            <span class="platform-tag">Web传感器API</span>
        </div>
    </header>
    
    <div class="dashboard" id="sensorDashboard">
        <!-- 传感器卡片将通过JavaScript动态生成 -->
    </div>
    
    <div class="controls">
        <button id="startBtn">开始检测</button>
        <button id="stopBtn" disabled>停止检测</button>
    </div>
    
    <div class="footer">
        <p>传感器检测系统 | 为教育目的设计 | 兼容多平台</p>
    </div>

    <script>
        // 传感器配置和数据
        const sensors = {
            accelerometer: {
                name: '加速度传感器',
                type: 'motion',
                values: ['x', 'y', 'z'],
                units: 'm/s²',
                supported: false,
                data: { x: 0, y: 0, z: 0 },
                sensorObject: null
            },
            gyroscope: {
                name: '陀螺仪',
                type: 'motion',
                values: ['x', 'y', 'z'],
                units: 'rad/s',
                supported: false,
                data: { x: 0, y: 0, z: 0 },
                sensorObject: null
            },
            magnetometer: {
                name: '磁力计',
                type: 'orientation',
                values: ['x', 'y', 'z'],
                units: 'μT',
                supported: false,
                data: { x: 0, y: 0, z: 0 },
                sensorObject: null
            },
            ambientLight: {
                name: '环境光传感器',
                type: 'environment',
                values: ['illuminance'],
                units: 'lx',
                supported: false,
                data: { illuminance: 0 },
                sensorObject: null
            },
            proximity: {
                name: '距离传感器',
                type: 'environment',
                values: ['distance'],
                units: 'cm',
                supported: false,
                data: { distance: 0 },
                sensorObject: null
            },
            orientation: {
                name: '方向传感器',
                type: 'orientation',
                values: ['alpha', 'beta', 'gamma'],
                units: '°',
                supported: false,
                data: { alpha: 0, beta: 0, gamma: 0 },
                sensorObject: null
            }
        };

        // 检测设备类型
        function detectPlatform() {
            const userAgent = navigator.userAgent;
            if (/android/i.test(userAgent)) return 'Android';
            if (/ipad|iphone|ipod/i.test(userAgent)) return 'iOS';
            if (/harmony|hongmeng/i.test(userAgent)) return 'HarmonyOS';
            return 'Unknown';
        }

        // 初始化传感器
        async function initSensors() {
            const platform = detectPlatform();
            document.querySelector('.platform-info').innerHTML += 
                `<span class="platform-tag">检测到: ${platform}</span>`;
            
            // 检查浏览器支持的传感器API
            try {
                // 检测加速度传感器
                if ('Accelerometer' in window) {
                    sensors.accelerometer.supported = true;
                    sensors.accelerometer.sensorObject = new Accelerometer({ frequency: 10 });
                    sensors.accelerometer.sensorObject.addEventListener('reading', () => {
                        sensors.accelerometer.data.x = sensors.accelerometer.sensorObject.x;
                        sensors.accelerometer.data.y = sensors.accelerometer.sensorObject.y;
                        sensors.accelerometer.data.z = sensors.accelerometer.sensorObject.z;
                        updateSensorCard('accelerometer');
                    });
                }
                
                // 检测陀螺仪
                if ('Gyroscope' in window) {
                    sensors.gyroscope.supported = true;
                    sensors.gyroscope.sensorObject = new Gyroscope({ frequency: 10 });
                    sensors.gyroscope.sensorObject.addEventListener('reading', () => {
                        sensors.gyroscope.data.x = sensors.gyroscope.sensorObject.x;
                        sensors.gyroscope.data.y = sensors.gyroscope.sensorObject.y;
                        sensors.gyroscope.data.z = sensors.gyroscope.sensorObject.z;
                        updateSensorCard('gyroscope');
                    });
                }
                
                // 检测磁力计
                if ('Magnetometer' in window) {
                    sensors.magnetometer.supported = true;
                    sensors.magnetometer.sensorObject = new Magnetometer({ frequency: 10 });
                    sensors.magnetometer.sensorObject.addEventListener('reading', () => {
                        sensors.magnetometer.data.x = sensors.magnetometer.sensorObject.x;
                        sensors.magnetometer.data.y = sensors.magnetometer.sensorObject.y;
                        sensors.magnetometer.data.z = sensors.magnetometer.sensorObject.z;
                        updateSensorCard('magnetometer');
                    });
                }
                
                // 检测环境光传感器
                if ('AmbientLightSensor' in window) {
                    sensors.ambientLight.supported = true;
                    try {
                        sensors.ambientLight.sensorObject = new AmbientLightSensor({ frequency: 1 });
                        sensors.ambientLight.sensorObject.addEventListener('reading', () => {
                            sensors.ambientLight.data.illuminance = sensors.ambientLight.sensorObject.illuminance;
                            updateSensorCard('ambientLight');
                        });
                    } catch (error) {
                        console.warn('环境光传感器访问被拒绝:', error);
                        sensors.ambientLight.supported = false;
                    }
                }
                
                // 使用DeviceOrientation事件作为方向传感器的后备方案
                if ('DeviceOrientationEvent' in window) {
                    sensors.orientation.supported = true;
                    window.addEventListener('deviceorientation', (event) => {
                        sensors.orientation.data.alpha = event.alpha; // 围绕Z轴旋转（0°-360°）
                        sensors.orientation.data.beta = event.beta;   // 围绕X轴旋转（-180°-180°）
                        sensors.orientation.data.gamma = event.gamma; // 围绕Y轴旋转（-90°-90°）
                        updateSensorCard('orientation');
                    });
                }
                
                // 使用DeviceProximityEvent作为距离传感器的后备方案
                if ('DeviceProximityEvent' in window) {
                    sensors.proximity.supported = true;
                    window.addEventListener('deviceproximity', (event) => {
                        sensors.proximity.data.distance = event.value;
                        updateSensorCard('proximity');
                    });
                }
                
            } catch (error) {
                console.error('初始化传感器时出错:', error);
            }
            
            // 渲染传感器卡片
            renderSensorCards();
        }

        // 渲染传感器卡片
        function renderSensorCards() {
            const dashboard = document.getElementById('sensorDashboard');
            dashboard.innerHTML = '';
            
            for (const [key, sensor] of Object.entries(sensors)) {
                const card = document.createElement('div');
                card.className = 'sensor-card';
                card.id = `${key}-card`;
                
                let sensorBody = '';
                if (sensor.supported) {
                    sensorBody = `
                        <div class="sensor-data">
                            ${sensor.values.map(value => `
                                <div class="data-row">
                                    <span>${value}:</span>
                                    <span class="data-value" id="${key}-${value}">0</span> ${sensor.units}
                                </div>
                            `).join('')}
                        </div>
                        <div class="sensor-visualization" id="${key}-visualization">
                            ${sensor.values.map((value, index) => `
                                <div class="visualization-bar" id="${key}-${value}-bar" 
                                     style="height: 0%; left: ${index * 35 + 10}px;"></div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    sensorBody = `
                        <div class="sensor-data">
                            <p>此设备不支持${sensor.name}或浏览器无访问权限</p>
                        </div>
                    `;
                }
                
                card.innerHTML = `
                    <div class="sensor-header">
                        <h3>${sensor.name}</h3>
                        <span class="sensor-status ${sensor.supported ? 'active' : ''}">
                            ${sensor.supported ? '支持' : '不支持'}
                        </span>
                    </div>
                    <div class="sensor-body">
                        ${sensorBody}
                    </div>
                `;
                
                dashboard.appendChild(card);
            }
        }

        // 更新传感器卡片数据
        function updateSensorCard(sensorType) {
            const sensor = sensors[sensorType];
            
            // 更新数值显示
            sensor.values.forEach(value => {
                const valueElement = document.getElementById(`${sensorType}-${value}`);
                if (valueElement) {
                    valueElement.textContent = sensor.data[value].toFixed(2);
                }
            });
            
            // 更新可视化效果
            const visualization = document.getElementById(`${sensorType}-visualization`);
            if (visualization) {
                sensor.values.forEach((value, index) => {
                    const bar = document.getElementById(`${sensorType}-${value}-bar`);
                    if (bar) {
                        // 根据传感器类型不同，采用不同的可视化策略
                        let height = 0;
                        if (sensorType === 'ambientLight') {
                            // 环境光传感器：0-10000lx映射到0-100%
                            height = Math.min(sensor.data[value] / 100, 100);
                        } else if (sensorType === 'proximity') {
                            // 距离传感器：0-100cm映射到0-100%
                            height = Math.min(sensor.data[value], 100);
                        } else {
                            // 其他传感器：基于绝对值计算百分比
                            const absValue = Math.abs(sensor.data[value]);
                            height = Math.min(absValue * 10, 100);
                        }
                        bar.style.height = `${height}%`;
                    }
                });
            }
        }

        // 开始传感器检测
        function startSensors() {
            for (const [key, sensor] of Object.entries(sensors)) {
                if (sensor.supported && sensor.sensorObject) {
                    try {
                        sensor.sensorObject.start();
                    } catch (error) {
                        console.error(`启动${sensor.name}时出错:`, error);
                    }
                }
            }
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
        }

        // 停止传感器检测
        function stopSensors() {
            for (const [key, sensor] of Object.entries(sensors)) {
                if (sensor.supported && sensor.sensorObject) {
                    try {
                        sensor.sensorObject.stop();
                    } catch (error) {
                        console.error(`停止${sensor.name}时出错:`, error);
                    }
                }
            }
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            initSensors();
            
            document.getElementById('startBtn').addEventListener('click', startSensors);
            document.getElementById('stopBtn').addEventListener('click', stopSensors);
        });
    </script>
</body>
</html>
